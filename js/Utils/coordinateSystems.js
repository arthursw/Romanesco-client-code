// Generated by CoffeeScript 1.7.1
(function() {
  define(['utils'], function() {
    R.projectToPlanet = function(point) {
      var planet, x, y;
      planet = {};
      x = point.x / R.scale;
      planet.x = Math.floor((x + 180) / 360);
      y = point.y / R.scale;
      planet.y = Math.floor((y + 90) / 180);
      return planet;
    };
    R.projectToPosOnPlanet = function(point, planet) {
      var pos;
      if (planet == null) {
        planet = R.projectToPlanet(point);
      }
      pos = {};
      pos.x = point.x / R.scale - 360 * planet.x;
      pos.y = point.y / R.scale - 180 * planet.y;
      return pos;
    };
    R.projectToPlanetJson = function(point) {
      var planet, pos;
      planet = R.projectToPlanet(point);
      pos = R.projectToPosOnPlanet(point, planet);
      return {
        pos: pos,
        planet: planet
      };
    };
    R.posOnPlanetToProject = function(point, planet) {
      var x, y;
      if ((point.x == null) && (point.y == null)) {
        point = R.arrayToPoint(point);
      }
      x = planet.x * 360 + point.x;
      y = planet.y * 180 + point.y;
      x *= R.scale;
      y *= R.scale;
      return new P.Point(x, y);
    };
    R.arrayToPoint = function(array) {
      return new P.Point(array);
    };
    R.pointToArray = function(point) {
      return [point.x, point.y];
    };
    R.pointToObj = function(point) {
      return {
        x: point.x,
        y: point.y
      };
    };
    R.getChatRoom = function() {
      return 'x: ' + Math.round(P.view.center.x / R.scale) + ', y: ' + Math.round(P.view.center.y / R.scale);
    };
    R.getTopLeftCorner = function() {
      return P.view.viewToProject(new P.Point(0, 0));
    };
    R.midPoint = function(p1, p2) {
      return new P.Point((p1.x + p2.x) * 0.5, (p1.y + p2.y) * 0.5);
    };
    R.viewToProjectRectangle = function(rectangle) {
      return new P.Rectangle(P.view.viewToProject(rectangle.topLeft), P.view.viewToProject(rectangle.bottomRight));
    };
    R.projectToViewRectangle = function(rectangle) {
      return new P.Rectangle(P.view.projectToView(rectangle.topLeft), P.view.projectToView(rectangle.bottomRight));
    };
    R.getLimit = function() {
      var planet;
      planet = R.projectToPlanet(R.getTopLeftCorner());
      return R.posOnPlanetToProject(new P.Point(-180, -90), new P.Point(planet.x + 1, planet.y + 1));
    };
    R.boxFromRectangle = function(rectangle) {
      var brOnPlanet, planet, points, tlOnPlanet;
      planet = R.pointToObj(R.projectToPlanet(rectangle.topLeft));
      tlOnPlanet = R.projectToPosOnPlanet(rectangle.topLeft, planet);
      brOnPlanet = R.projectToPosOnPlanet(rectangle.bottomRight, planet);
      points = [];
      points.push(R.pointToArray(tlOnPlanet));
      points.push(R.pointToArray(R.projectToPosOnPlanet(rectangle.topRight, planet)));
      points.push(R.pointToArray(brOnPlanet));
      points.push(R.pointToArray(R.projectToPosOnPlanet(rectangle.bottomLeft, planet)));
      points.push(R.pointToArray(tlOnPlanet));
      return {
        points: points,
        planet: R.pointToObj(planet),
        tl: tlOnPlanet,
        br: brOnPlanet
      };
    };
    R.rectangleFromBox = function(box) {
      var br, planet, tl;
      planet = new P.Point(box.planetX, box.planetY);
      tl = R.posOnPlanetToProject(box.box.coordinates[0][0], planet);
      br = R.posOnPlanetToProject(box.box.coordinates[0][2], planet);
      return new P.Rectangle(tl, br);
    };
    R.quantizeZoom = function(zoom) {
      if (zoom < 5) {
        zoom = 1;
      } else if (zoom < 25) {
        zoom = 5;
      } else {
        zoom = 25;
      }
      return zoom;
    };
  });

}).call(this);

//# sourceMappingURL=CoordinateSystems.map
